<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/login.css') }}">
</head>
<body>
  <div class="container">
    <div class="logo">
      <div class="logo-icon">üîê</div>
      <h1>Bienvenido</h1>
      <p class="subtitle">Ingresa tus credenciales para continuar</p>
    </div>

    <!-- Mensaje de √©xito (verde) -->
    <div id="successBox" class="success"> Registro exitoso. Ahora puedes iniciar sesi√≥n.</div>

    <!-- Mensaje de error (rojo) -->
    <div id="errorBox" class="error">Usuario o contrase√±a inv√°lidos</div>

    <form id="loginForm" action="/auth/login" method="post" autocomplete="on">
      <div class="form-group">
        <label for="usuario">Correo</label>
        <input
          type="text"
          id="usuario"
          name="email"
          placeholder="Ingresa tu correo"
          required
          autocomplete="username"
          autofocus
        >
      </div>

      <div class="form-group">
        <label for="password">Contrase√±a</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="Ingresa tu contrase√±a"
          required
          autocomplete="current-password"
        >
      </div>

      <button type="submit" class="btn-login" id="submitBtn">Iniciar Sesi√≥n</button>
    </form>

    <div class="register-link">
      <p>¬øNo tienes cuenta? <a href="/registro">Reg√≠strate aqu√≠</a></p>
    </div>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const successBox = document.getElementById('successBox');
      const errorBox = document.getElementById('errorBox');

      // Mostrar error si viene ?error=1
      if (params.get('error') === '1' && errorBox) {
        errorBox.style.display = 'block';
      }

      // Mostrar √©xito si viene ?registered=1 (persistente)
      if (params.get('registered') === '1' && successBox) {
        successBox.style.display = 'block';
      }
    })();

    // Prevenci√≥n de doble env√≠o mejorada
    (function () {
      const form = document.getElementById('loginForm');
      const btn = document.getElementById('submitBtn');
      if (!form || !btn) return;

      let submitted = false;

      form.addEventListener('submit', function(e) {
        if (submitted) {
          e.preventDefault();
          return false;
        }
        submitted = true;
        btn.disabled = true;
        btn.textContent = 'Ingresando...';
      });
    })();
  </script>
</body>
</html>
